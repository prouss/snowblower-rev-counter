<!DOCTYPE html>
<!-- THIS FILE WAS GENERATED BY HTP. DO NOT EDIT! -->
<!-- Source file is in src/rpm-counting.htp. -->
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Snowblower-rev-counter by prouss</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  <meta name="Generator" content="htp 1.18">
</head>
  <body>
    <section class="page-header">
      <h1 class="project-name" style="margin-bottom: 10px;">Snowblower-rev-counter</h1>
      <h2 class="project-tagline" style="margin-bottom: 20px; margin-top: 10px;">snowblower revolution counter</h2>
      <a href="index.html" class="btn">Home</a>
      <a href="https://github.com/prouss/snowblower-rev-counter" class="btn">View on GitHub</a>
      <a href="https://github.com/prouss/snowblower-rev-counter/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/prouss/snowblower-rev-counter/tarball/master" class="btn">Download .tar.gz</a>
    </section>
    <section class="main-content">
              	<h1>Counting and displaying RPM</h1>
	<p>This page contains the information on all activities related to counting and displaying the number of revolutions per minute.</p>
	
	<!---- 05/30/2015: First Prototype --->
   	<hr>
	<a name="FirstPrototype"><h2>05/30/2015: First Prototype</h2></a>
<p>The idea for his first prototype was that we would have some sort of device that would generate a square pulse for each engine revolution.
By measuring the time between two pulses (the <i>t</i> in figure 1 below) we could easily compute the number of revolutions per minutes (RPM).</p>
<figure>
	<img src="images/measuring-time-between pulses.png" alt="Prototype Working in Freezer">
	<figcaption>Figure 1 - Measuring elapsed time between two pulses</figcaption>
</figure>
<p>Inspired by a robotic lab at high school where he had to measure the length of a pulse in order to evaluated the distance measured by a HC-SR04 sonar, Étienne wrote an Arduino
sketch for measuring the time between two pulses, convert it to RPM, and display it on a LCD. The code for this sketch is shown in figure 2.
<figure>
	<div class="code">
<pre>#include <Arduino.h>
#include <Wire.h>
#include <LiquidCrystal_I2C.h>
LiquidCrystal_I2C lcd(0x27,16,2);

void setup()
{
  lcd.init();
  lcd.backlight();
  pinMode(3,INPUT);
}

int RPM()
{
  unsigned long gap = pulseIn(3,LOW) + pulseIn(3,HIGH);
  int rpm = 0;
  if (gap != 0)
  {
    rpm = 60000000/gap;
  }
  return rpm;
}

void loop()
{
  int rpm = RPM();
  lcd.clear();
  lcd.setCursor(0,0);
  lcd.print(rpm);
  delay(500);
}</pre>
	</div>
	<figcaption>Figure 2 - Code for counting RPM</figcaption>
</figure>
<p>In order to test the RPM counting sketch, Étienne wrote a second sketch for generating pulses at specific frequencies.
The code for this sketch is shown in figure 3.<p>
<figure>
	<div class="code">
<pre>void setup()
{
  pinMode(3,OUTPUT);
}

int rpm = 2000;
unsigned long gap = 60000/rpm;
  
void loop()
{
  digitalWrite(3,LOW);
  delay(gap);
  digitalWrite(3,HIGH);
  delay(1);
}</pre>
	</div>
	<figcaption>Figure 3 - Code for generating pulses</figcaption>
</figure>
<p>The figure 4 shows two Arduinos running the two sketches. The Arduino connected to a PC with a USB cable is the pulse generator.
The Arduino connected to the display is the one that measure the elapsed time between two pulses and convert that to RPM.<p>
<figure>
	<img src="images/2015-06-06 10.49.03.jpg" alt="Prototype Working in Freezer">
	<figcaption>Fugure 4 - Two Arduinos : the pulse generator and the RPM counter</figcaption>
</figure>
<p>Using the PC, Étienne ran the generator at different frequencies (by modifying the rpm variable in the sketch) and he notices that the displayed RPM was not exactly matching the frequency of the generator.
This is due to the timing of some instructions that is not accounted for. We will fix that at a later time.<p>
	
	
	<!---- 06/20/2015: Using a 3.3v Arduino --->
	<hr>
    <a name="MiniPro33"><h2>06/20/2015: Using a 3.3v Arduino</h2></a>
We used a 3.3v Arduino mini pro instead of the original 5v Arduino, and we added a 5v to 3.3v level converter between the Arduino and the LCD. We are running the same code as in the original prototype. Nothing else was changed.<p>
<figure>
	<img src="images/2015-06-20 10.51.10.jpg" alt="Initial Design">
	<figcaption>Figure 1 - RPM counting using a 3.3v Arduino</figcaption>
</figure>
<p>The top Arduino Uno (in blue) is running the pulse generator sketch. The 3.3v Arduinio mini pro (with the red led on the bread board) is running the RPM counting sketch.
The cable attached to the LCD is leading to the level converter in the middle of the screen.</p>
	
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/prouss/snowblower-rev-counter">Snowblower-rev-counter</a> is maintained by <a href="https://github.com/prouss">Pierre Rousseau</a> and <a href="https://github.com/pouti">Étienne Lapointe-Rousseau</a>.</span>
      </footer>
    </section>
  </body>
</html>
